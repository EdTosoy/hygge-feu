import{b as M,r as m,T as V,j as p,K as W,N as S,Q as D,V as F,W as I,X as N,Y as T,Z as b}from"./index-B6cNwYG_.js";import{u as K}from"./UseAppDispatch-ikqRfIpi.js";import{u as _}from"./UseAppSelector-Dqq9XBwt.js";import{s as Q}from"./selectors-wa7v8kcT.js";import{s as R}from"./selectors-CO56ze6E.js";function z(){const i=K(),l=_(Q),c=_(R),{pathname:O}=M(),{toggleModal:w,setModalContent:h}=m.useContext(V),[r,d]=m.useState([]),P=O.split("/")[2];m.useEffect(()=>{(async()=>{await i(W()).unwrap()})()},[]),m.useEffect(()=>{const u=l.length&&l.map(t=>({...t,showOptions:!1})).filter(t=>t.category===P);d(u||[])},[l.length,P]);const j=()=>r==null?void 0:r.map((u,t)=>{const{_id:a,content:B,likes:C,savedBy:L}=u,A=!!C.includes(c._id),E=!!L.includes(c._id),f=()=>{const e=[...r];e[t].showOptions===!0?e[t].showOptions=!1:(e.map(o=>o.showOptions=!1),e[t].showOptions=!0),d(e)},y=()=>{h(p.jsx(D,{contentValue:B,postId:a})),w()},g=async()=>{await i(F({postId:a})).unwrap(),window.location.reload()},v=async e=>{const o=[...r];if(A){const n=o[t].likes.filter(s=>s!==c._id);o[t].likes=n,d(o),await i(I(a)).unwrap()}else{const n=o.map(s=>s._id===e?{...s,likes:[...s.likes,c._id]}:s);d(n),await i(N(a)).unwrap()}},k=async e=>{const o=[...r];if(E){const n=o[t].savedBy.filter(s=>s!==c._id);o[t].savedBy=n,d(o),await i(T({postId:e})).unwrap()}else{const n=o.map(s=>s._id===e?{...s,savedBy:[...s.savedBy,c._id]}:s);d(n),await i(b({postId:e})).unwrap()}},x=()=>{h(p.jsx("div",{className:"p-5",children:p.jsx(S,{post:u,handleDeletePost:g,handleEditPost:y,handleLikePost:()=>v(a),handleSavePost:()=>k(a),toggleShowOptions:f,isModalView:!0},a)})),w()};return p.jsx(S,{post:u,handleDeletePost:g,handleEditPost:y,handleLikePost:()=>v(a),handleSavePost:()=>k(a),toggleShowOptions:f,handleOnClickComment:x},a)});return p.jsx("div",{children:(l==null?void 0:l.length)>0&&j()})}export{z as CommunityFeed};
