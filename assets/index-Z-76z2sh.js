import{r as P,T as M,j as p,K as V,N as _,Q as W,V as D,W as F,X as I,Y as N,Z as T}from"./index-B6cNwYG_.js";import{u as K}from"./UseAppDispatch-ikqRfIpi.js";import{u as h}from"./UseAppSelector-Dqq9XBwt.js";import{s as Q}from"./selectors-wa7v8kcT.js";import{s as R,a as U}from"./selectors-CO56ze6E.js";function z(){const l=K(),i=h(Q),c=h(R),w=h(U),O=w==null?void 0:w.savedPosts,{toggleModal:m,setModalContent:f}=P.useContext(M),[r,d]=P.useState([]);P.useEffect(()=>{const u=i.length&&i.map(a=>({...a,showOptions:!1}));d(u||[])},[i.length,O]),P.useEffect(()=>{(async()=>{await l(V()).unwrap()})()},[]);const j=()=>r==null?void 0:r.map((u,a)=>{const{_id:o,content:B,likes:A,savedBy:E}=u,L=!!A.includes(c._id),x=!!E.includes(c._id),v=()=>{const t=[...r];t[a].showOptions===!0?t[a].showOptions=!1:(t.map(e=>e.showOptions=!1),t[a].showOptions=!0),d(t)},k=()=>{f(p.jsx(W,{contentValue:B,postId:o})),m()},y=async()=>{await l(D({postId:o})).unwrap(),window.location.reload()},g=async t=>{const e=[...r];if(L){const n=e[a].likes.filter(s=>s!==c._id);e[a].likes=n,d(e),await l(F(o)).unwrap()}else{const n=e.map(s=>s._id===t?{...s,likes:[...s.likes,c._id]}:s);d(n),await l(I(o)).unwrap()}},S=async t=>{const e=[...r];if(x){const n=e[a].savedBy.filter(s=>s!==c._id);e[a].savedBy=n,d(e),await l(N({postId:t})).unwrap()}else{const n=e.map(s=>s._id===t?{...s,savedBy:[...s.savedBy,c._id]}:s);d(n),await l(T({postId:t})).unwrap()}},C=()=>{f(p.jsx("div",{className:"p-5",children:p.jsx(_,{post:u,handleDeletePost:y,handleEditPost:k,handleLikePost:()=>g(o),handleSavePost:()=>S(o),toggleShowOptions:v,isModalView:!0},o)})),m()};return p.jsx(_,{post:u,handleDeletePost:y,handleEditPost:k,handleLikePost:()=>g(o),handleSavePost:()=>S(o),toggleShowOptions:v,handleOnClickComment:C},o)});return p.jsx("div",{children:(i==null?void 0:i.length)>0&&j()})}export{z as PopularFeed};
